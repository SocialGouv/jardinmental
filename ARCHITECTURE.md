# Jardin Mental - Dossier d'Architecture

## 1. PROJET - ACTEURS

### Nom du projet applicatif

**Jardin Mental**

### Contexte projet applicatif

Les troubles psychiatriques touchent plus de 20 % de la population, Ã  un moment de la vie. Et trouver le bon traitement peut prendre plusieurs annÃ©es. Pendant ce temps-lÃ , les symptÃ´mes Ã©voluent, peuvent devenir chroniques et l'Ã©tat du patient s'aggrave. L'impact peut Ãªtre dramatique.

### Objectifs projet applicatif

Le mÃ©decin choisit ou modifie un traitement en se basant sur ce que lui rapporte la personne durant la consultation. Mais le mÃ©decin n'a que peu de temps avec la personne concernÃ©e et les informations rapportÃ©es ne sont pas fiables.

Les jeunes que nous avons interrogÃ©s rapportent en effet avoir du mal Ã  dire tout ce qu'ils souhaitent en consultation et expliquent repartir en ayant bien souvent omis de transmettre une ou plusieurs informations importantes.

C'est qu'il est trÃ¨s difficile de donner une reprÃ©sentation fiable de ses symptÃ´mes et de l'Ã©volution de ceux-ci.

**Pourquoi ?** Car aucun humain n'est capable de se souvenir fidÃ¨lement de l'Ã©volution de son Ã©tat psychique sur une durÃ©e trop longue.

Il est par exemple quasiment impossible de se rappeler la qualitÃ© de son sommeil 3 semaines auparavant, d'Ãªtre suffisamment prÃ©cis sur le nombre de crise d'angoisse survenues le mois dernier, l'intensitÃ© de celles-ci et leur impact sur notre quotidien, ou encore de se rappeler de ces jours oÃ¹ Ã§a allait vraiment bien, alors que les jours prÃ©cÃ©dant le rendez-vous, la tristesse nous a envahit...

### Enjeux projet applicatif

Plus les informations concernant mes symptÃ´mes sont proches de la rÃ©alitÃ©, de ce que je vis, plus mon mÃ©decin sera en mesure de me prescrire le bon traitement, celui qui sera le plus efficace possible avec le moins d'effets indÃ©sirables.

**Jardin Mental, c'est une aide pour un dialogue continu, qui s'adresse Ã  tous, co-construite avec les usagers, comprenant :**

- La possibilitÃ© de sÃ©lectionner les symptÃ´mes et les effets indÃ©sirables des traitements mÃ©dicaux Ã  suivre
- Un rappel quotidien pour m'aider Ã  y penser
- Des Ã©crans simples permettant une saisie rapide
- Une synthÃ¨se de l'Ã©volution de l'intensitÃ© des symptÃ´mes au cours du temps
- Un accÃ¨s Ã  des donnÃ©es informatives concernant les symptÃ´mes suivis
- Un parcours motivationnel dans la participation Ã  mon suivi

Jardin Mental, c'est permettre aux personnes suivies de rester au plus prÃ¨s de leur expÃ©rience et d'en rendre compte le plus fidÃ¨lement possible au mÃ©decin, pour lui permettre de participer Ã  soulager la souffrance grÃ¢ce Ã  une intervention mÃ©dicamenteuse adÃ©quate, personnalisÃ©e et rapide.

### Planning projet

| Version | Date | Description |
| ------- | ---- | ----------- |
| â€”       | â€”    | â€”           |

### Acteurs Projet

| RÃ´le                   | Nom               | EntitÃ©             |
| ---------------------- | ----------------- | ------------------ |
| Intrapreneur           | â€”                 | â€”                  |
| ChargÃ© de portefeuille | REZGUI Lycia      | Fabrique NumÃ©rique |
| Product Manager        |                   |                    |
| Partie prenante        | â€”                 | â€”                  |
| Designer UX/UI         |                   | â€”                  |
| DÃ©veloppeur            |                   |                    |
| DÃ©veloppeur            | â€”                 | â€”                  |
| DÃ©veloppeur            | â€”                 | â€”                  |
| Equipe plateforme      | VAN-WOERKENS Gary | Fabrique NumÃ©rique |
| Equipe plateforme      | RENQUIN Igor      | Fabrique NumÃ©rique |

### Acteurs mÃ©tiers du SI applicatif

Identifier les profils d'utilisateurs de l'applicatif, leur provenance et leur nombre

| Profils utilisateurs    | MCAS | RIE, intermin | Externe | Public |
| ----------------------- | ---- | ------------- | ------- | ------ |
| Equipe Produit          | â€”    | â€”             | X       | â€”      |
| Citoyens                | â€”    | â€”             | â€”       | X      |
| Patients                | â€”    | â€”             | â€”       | X      |
| Professionnels de santÃ© | â€”    | â€”             | â€”       | â€”      |

---

## 2. FONCTIONNALITES â€“ DONNEES

### FonctionnalitÃ©s du SI Applicatif

#### FonctionnalitÃ©s du SI Applicatif - Site Ã©ditorial

| FonctionnalitÃ©s          | MCAS | RIE, intermin | Externe | Public |
| ------------------------ | ---- | ------------- | ------- | ------ |
| Informations Ã©ditoriales | â€”    | â€”             | â€”       | X      |

#### FonctionnalitÃ©s du SI Applicatif - Statistiques

| FonctionnalitÃ©s                                                                                                                              | MCAS | RIE, intermin | Externe | Public |
| -------------------------------------------------------------------------------------------------------------------------------------------- | ---- | ------------- | ------- | ------ |
| Analyse de la donnÃ©e d'usage de l'application par l'utilisateur (du parcours utilisateur dans l'application, nb connexion, type de terminal) | â€”    | â€”             | X       | â€”      |

#### FonctionnalitÃ©s du SI Applicatif - Application Mobile

| FonctionnalitÃ©s                                                                                                                               | MCAS | RIE, intermin | Externe | Public |
| --------------------------------------------------------------------------------------------------------------------------------------------- | ---- | ------------- | ------- | ------ |
| Un questionnaire entiÃ¨rement paramÃ©trable permettant aux usagers de suivre l'ensemble des critÃ¨res de leurs choix ainsi que leurs traitements | â€”    | â€”             | â€”       | X      |
| Les colonnes de beck : un exercice de psychothÃ©rapie                                                                                          | â€”    | â€”             | â€”       | X      |
| Les analyses : un ensemble de vue permettant d'avoir une analyse des donnÃ©es renseignÃ©es                                                      | â€”    | â€”             | â€”       | X      |
| Des notes : permettant Ã  l'usagers de renseigner des Ã©lÃ©ments pour une journÃ©e donnÃ©e sous forme de texte libre                               | â€”    | â€”             | â€”       | X      |
| L'export de donnÃ©es : sous forme d'e-mail vers un destinataire au choix                                                                       | â€”    | â€”             | â€”       | X      |
| Un module de retour utilisateur                                                                                                               | â€”    | â€”             | â€”       | X      |
| Se fixer et suivre des objectifs Ã  rÃ©aliser                                                                                                   | â€”    | â€”             | â€”       | X      |
| Demande sur les consommations, addictions                                                                                                     | â€”    | â€”             | â€”       | X      |

### DonnÃ©es mÃ©tier du SI Applicatif

| DonnÃ©es mÃ©tier du SI Applicatif | MCAS | RIE, intermin | Externe | Public |
| ------------------------------- | ---- | ------------- | ------- | ------ |
| â€”                               | â€”    | â€”             | â€”       | â€”      |

### RÃ©fÃ©rentiel de donnÃ©es hors SI Applicatif

| Fichiers mÃ©tier du SI Applicatif | MCAS | RIE, intermin | Externe | Public |
| -------------------------------- | ---- | ------------- | ------- | ------ |
| â€”                                | â€”    | â€”             | â€”       | â€”      |

### SensibilitÃ© des donnÃ©es dans le SI Applicatif

#### SensibilitÃ© des donnÃ©es - Site Ã©ditoriale

| Type de donnÃ©es trÃ¨s sensible | PrÃ©sence | Type de donnÃ©es Sensible | PrÃ©sence | Type de donnÃ©es Public    | PrÃ©sence |
| ----------------------------- | -------- | ------------------------ | -------- | ------------------------- | -------- |
| NIR                           | â€”        | Architecture technique   | â€”        | Editoriaux                | X        |
| MÃ©dicales                     | â€”        | Organisationnel          | â€”        | Publication extranet      | â€”        |
| Vie PrivÃ©e                    | â€”        | Etat civil               | â€”        | Campagne de communication | â€”        |
| Justice                       | â€”        | Adresse postale          | â€”        | Statistiques publiables   | X        |
| IdentitÃ©                      | â€”        | Vie personnelle          | â€”        |                           |          |
| BiomÃ©trique                   | â€”        | Vie professionnelle      | â€”        |                           |          |
| MÃ©canisme de fraude           | â€”        | Mouvements salariaux     | â€”        |                           |          |
| Architecture SÃ©curisÃ©         | â€”        | SantÃ© Ã©conomique         | â€”        |                           |          |
| Failles & VulnÃ©rabilitÃ©       | â€”        |                          |          |                           |          |
| Patrimoine                    | â€”        |                          |          |                           |          |
| Appartenance syndicale        | â€”        |                          |          |                           |          |

#### SensibilitÃ© des donnÃ©es - Statistiques

| Type de donnÃ©es trÃ¨s sensible | PrÃ©sence | Type de donnÃ©es Sensible | PrÃ©sence | Type de donnÃ©es Public    | PrÃ©sence |
| ----------------------------- | -------- | ------------------------ | -------- | ------------------------- | -------- |
| NIR                           | â€”        | Architecture technique   | â€”        | Editoriaux                | â€”        |
| MÃ©dicales                     | â€”        | Organisationnel          | â€”        | Publication extranet      | â€”        |
| Vie PrivÃ©e                    | â€”        | Etat civil               | â€”        | Campagne de communication | â€”        |
| Justice                       | â€”        | Adresse postale          | â€”        | Statistiques publiables   | â€”        |
| IdentitÃ©                      | â€”        | Vie personnelle          | â€”        |                           |          |
| BiomÃ©trique                   | â€”        | Vie professionnelle      | â€”        |                           |          |
| MÃ©canisme de fraude           | â€”        | Mouvements salariaux     | â€”        |                           |          |
| Architecture SÃ©curisÃ©         | â€”        | SantÃ© Ã©conomique         | â€”        |                           |          |
| Failles & VulnÃ©rabilitÃ©       | â€”        |                          |          |                           |          |
| Patrimoine                    | â€”        |                          |          |                           |          |
| Appartenance syndicale        | â€”        |                          |          |                           |          |

#### SensibilitÃ© des donnÃ©es - Application mobile

| Type de donnÃ©es trÃ¨s sensible | PrÃ©sence | Type de donnÃ©es Sensible | PrÃ©sence | Type de donnÃ©es Public    | PrÃ©sence |
| ----------------------------- | -------- | ------------------------ | -------- | ------------------------- | -------- |
| NIR                           | â€”        | Architecture technique   | â€”        | Editoriaux                | â€”        |
| **MÃ©dicales**                 | **X**    | Organisationnel          | â€”        | Publication extranet      | â€”        |
| **Vie PrivÃ©e**                | **X**    | Etat civil               | â€”        | Campagne de communication | â€”        |
| Justice                       | â€”        | Adresse postale          | â€”        | Statistiques publiables   | â€”        |
| IdentitÃ©                      | â€”        | Vie personnelle          | â€”        |                           |          |
| BiomÃ©trique                   | â€”        | Vie professionnelle      | â€”        |                           |          |
| MÃ©canisme de fraude           | â€”        | Mouvements salariaux     | â€”        |                           |          |
| Architecture SÃ©curisÃ©         | â€”        | SantÃ© Ã©conomique         | â€”        |                           |          |
| Failles & VulnÃ©rabilitÃ©       | â€”        |                          |          |                           |          |
| Patrimoine                    | â€”        |                          |          |                           |          |
| Appartenance syndicale        | â€”        |                          |          |                           |          |

### Services utilisÃ©s par l'application

| Services utilisÃ©s par l'application | Mode d'Ã©change | MCAS | RIE, intermin | Externe | Public |
| ----------------------------------- | -------------- | ---- | ------------- | ------- | ------ |
| TIPIMAIL                            | SMTP           | â€”    | â€”             | X       | â€”      |

---

## 3. CONTRAINTES â€“ VOLUMETRIE

### Contraintes lÃ©gales

Ã€ complÃ©ter

### Contraintes mÃ©tiers

Ã€ complÃ©ter

### Normes et rÃ¨gles Ã  respecter

| Norme    | Description                                             |
| -------- | ------------------------------------------------------- |
| **RGPD** | RÃ¨glement GÃ©nÃ©ral sur la Protection des DonnÃ©es         |
| **RGAA** | RÃ©fÃ©rentiel GÃ©nÃ©ral d'AccessibilitÃ© des Administrations |
| **RGS**  | RÃ©fÃ©rentiel GÃ©nÃ©ral de SÃ©curitÃ©                         |
| **RGI**  | RÃ©fÃ©rentiel GÃ©nÃ©ral d'InteropÃ©rabilitÃ©                  |

### DÃ©pendances avec d'autres SI

| Nom du SI Applicatif | Fournisseur | Consommateur |
| -------------------- | ----------- | ------------ |
| â€”                    | â€”           | â€”            |

### DÃ©pendances avec le poste de travail

| DÃ©pendance avec le terminal utilisateur | Composant    |
| --------------------------------------- | ------------ |
| O.S.                                    | Android, iOS |
| Navigateur                              | â€”            |
| Suite bureautique                       | â€”            |
| Plugin, Addin                           | â€”            |
| PÃ©riphÃ©rique                            | â€”            |

### VolumÃ©trie donnÃ©es du SI Applicatif

**Note importante :** La majoritÃ© des donnÃ©es utilisateur (DiaryData, Indicators, Goals, etc.) sont stockÃ©es localement sur le terminal mobile (AsyncStorage), pas sur le serveur. La base de donnÃ©es serveur ne contient que les utilisateurs anonymisÃ©s et leurs rappels.

#### MÃ©triques utilisateurs (stores + analytics)

_DonnÃ©es collectÃ©es le 09/02/2026 (pÃ©riode : 30 derniers jours)_

| MÃ©trique                                      | Valeur                      | Source                | Notes                                    |
| --------------------------------------------- | --------------------------- | --------------------- | ---------------------------------------- |
| **Installations totales (iOS)**               | **128,000**                 | App Store Connect     | Cumul depuis lancement                   |
| **Installations totales (Android)**           | **37,781**                  | Google Play Console   | Cumul depuis lancement                   |
| **Installations totales (combinÃ©)**           | **165,781**                 | Stores                | iOS + Android                            |
| **Utilisateurs actifs stores (30j)**          | **1,991**                   | Stores                | iOS: 722, Android: 1,269                 |
| **Utilisateurs actifs mensuels (MAU)**        | **4,192**                   | Matomo                | Visiteurs uniques 30 derniers jours      |
| **Utilisateurs actifs quotidiens (DAU)**      | **1,455**                   | Matomo                | Moyenne journaliÃ¨re rÃ©cente              |
| **Ratio DAU/MAU**                             | **34.7%**                   | CalculÃ©               | TrÃ¨s bon taux d'engagement               |
| **Sessions par mois**                         | **~14,507**                 | Matomo                | ~484 sessions/jour                       |
| **Ã‰vÃ©nements trackÃ©s par mois**               | **277,212**                 | Matomo                | ~9,240 Ã©vÃ©nements/jour                   |
| **Actions par session**                       | **19.1**                    | Matomo                | Engagement Ã©levÃ©                         |
| **DurÃ©e moyenne session**                     | **3 min 59s**               | Matomo                | Indicateur d'engagement                  |
| **Taux de rÃ©tention J+7**                     | Non disponible              | Stores / Matomo       | Non accessible dans interfaces stores    |
| **Taux de rÃ©tention J+30**                    | Non disponible              | Stores / Matomo       | Non accessible dans interfaces stores    |
| **Croissance mensuelle (nouveaux utilisateurs)** | **~2,637**               | Stores                | iOS: 775/mois, Android: 1,862/mois       |

#### VolumÃ©trie Base de donnÃ©es PostgreSQL (serveur)

_DonnÃ©es collectÃ©es le 09/02/2026 via requÃªtes SQL directes sur la base de production._

| ID  | Description                                          | Valeur                    | Calcul/Source                      |
| --- | ---------------------------------------------------- | ------------------------- | ---------------------------------- |
| D1  | Nombre d'utilisateurs actuels (AnonymisedUser)       | **55,145**                | Query: `SELECT COUNT(*) FROM "AnonymisedUser"` |
| D2  | Nombre de rappels actuels (Reminder)                 | **276,012**               | Query: `SELECT COUNT(*) FROM "Reminder"` |
| D3  | Taille actuelle de la base de donnÃ©es (Mo)           | **188 MB**                | PostgreSQL: `pg_database_size`     |
| D4  | Nombre de nouveaux utilisateurs par mois (moyenne)   | **~2,637**                | EstimÃ© depuis stores (iOS + Android) |
| D5  | Nombre de nouveaux rappels par mois (moyenne)        | **~13,185**               | D4 Ã— (D2/D1) = 2,637 Ã— 5           |
| D6  | Taille moyenne par utilisateur (Ko)                  | **~3.4 KB**               | D3 / D1 = 188 MB / 55,145          |
| D7  | Croissance mensuelle de la BDD (Mo/mois)             | **~9 MB/mois**            | D4 Ã— D6 = 2,637 Ã— 3.4 KB           |
| D8  | Volume BDD projetÃ© Ã  1 an (Mo)                       | **~296 MB** (0.29 GB)     | D3 + (D7 Ã— 12) = 188 + 108         |
| D9  | Volume BDD projetÃ© Ã  3 ans (Mo)                      | **~511 MB** (0.50 GB)     | D3 + (D7 Ã— 36) = 188 + 323         |

**Observations PostgreSQL :**
- **Base trÃ¨s lÃ©gÃ¨re** : 188 MB pour 55K utilisateurs = architecture efficace
- **~5 rappels/utilisateur** : bonne adoption de la fonctionnalitÃ© notifications
- **33% conversion** : 55K users en base vs 165K installations (normale pour apps santÃ©)
- **ScalabilitÃ© excellente** : croissance de ~9 MB/mois, aucun problÃ¨me prÃ©vu

### VolumÃ©trie fichiers du SI Applicatif

**Note :** L'application ne stocke pas de fichiers cÃ´tÃ© serveur. Les images, PDF et autres contenus statiques sont :
- Soit embarquÃ©s dans l'application mobile (assets)
- Soit hÃ©bergÃ©s via CDN externe
- Les donnÃ©es utilisateur sont en AsyncStorage (appareil mobile)

#### VolumÃ©trie logs et monitoring

_Note : DonnÃ©es techniques non collectÃ©es. NÃ©cessite accÃ¨s Kubernetes, Sentry admin et Matomo admin._

| ID  | Description                                    | Valeur            | Source/Calcul                    |
| --- | ---------------------------------------------- | ----------------- | -------------------------------- |
| L1  | Volume de logs applicatifs par jour (Mo)       | [Ã€ COLLECTER]     | Kubernetes logs                  |
| L2  | Volume de logs Sentry par mois (Ã©vÃ©nements)    | [Ã€ COLLECTER]     | Sentry dashboard                 |
| L3  | Volume de donnÃ©es Matomo par mois (Mo)         | [Ã€ COLLECTER]     | Matomo admin                     |
| L4  | RÃ©tention des logs (jours)                     | [Ã€ COLLECTER]     | Configuration infrastructure     |
| L5  | Volume total logs mensuel (Go)                 | [Ã€ CALCULER]      | (L1 Ã— 30) / 1024                 |

#### Analyse et insights volumÃ©trie

**RÃ©partition des installations (stores) :**
- **iOS domine** avec 77% des installations totales (128K vs 37.8K Android)
- **Android plus dynamique** en croissance rÃ©cente : ~2,010 nouveaux/mois vs 775 sur iOS
- **Utilisateurs actifs** : 1,991 sur stores (30 jours) vs 4,192 MAU Matomo
  - Ã‰cart expliquÃ© par : dÃ©finitions diffÃ©rentes entre stores et analytics, multi-appareils

**Engagement utilisateur (Matomo) :**
- **Excellent taux d'engagement** : 34.7% DAU/MAU (industrie moyenne ~20%)
  - SuggÃ¨re que ~73% des utilisateurs ouvrent l'app quotidiennement
- **19.1 actions/session** : trÃ¨s Ã©levÃ©, indique une utilisation intensive
- **3m59s/session** : durÃ©e cohÃ©rente avec usage de saisie de donnÃ©es santÃ© mentale
- **~484 sessions/jour** : usage quotidien rÃ©gulier et distribuÃ©

**Croissance et projections :**
- **Croissance mensuelle combinÃ©e** : ~2,785 nouveaux utilisateurs/mois
- **Tendance** : AccÃ©lÃ©ration sur Android, stabilisation sur iOS (marchÃ© mature)
- **Base utilisateurs actifs stable** : ~2,000 utilisateurs quotidiens
- **RÃ©tention** : Non mesurable directement, mais excellent DAU/MAU suggÃ¨re forte rÃ©tention

**Implications techniques :**
- **Charge serveur limitÃ©e** : donnÃ©es stockÃ©es cÃ´tÃ© client (AsyncStorage)
- **Backend lÃ©ger** : uniquement AnonymisedUser + Reminders en PostgreSQL (188 MB)
- **ScalabilitÃ© excellente** :
  - Base actuelle : 188 MB pour 55K users
  - Croissance : ~9 MB/mois
  - Projection 3 ans : ~511 MB (< 1 GB)
  - Aucune refonte nÃ©cessaire
- **Conversion 33%** : 55K users en base vs 165K installations (normale pour apps santÃ©)
- **Monitoring robuste** : 277K Ã©vÃ©nements Matomo/mois = visibilitÃ© complÃ¨te usage

### RÃ©duction volume de donnÃ©es

#### StratÃ©gie de gestion du volume

**Base de donnÃ©es PostgreSQL :**
- **Utilisateurs inactifs** : [DÃ©finir politique] - ex: suppression aprÃ¨s 24 mois d'inactivitÃ©
- **Rappels orphelins** : Nettoyage automatique si utilisateur supprimÃ© (cascade)
- **Tokens expirÃ©s** : Nettoyage des tokens de notification invalides (dÃ©tectÃ©s lors de l'envoi)

**Logs et monitoring :**
- **Logs Kubernetes** : RÃ©tention Ã  dÃ©finir (recommandÃ© : 30-90 jours)
- **Logs Sentry** : RÃ©tention selon plan souscrit
- **Analytics Matomo** : Pas de limite, donnÃ©es anonymisÃ©es et agrÃ©gÃ©es

**DonnÃ©es utilisateur (mobile) :**
- Aucune purge serveur (donnÃ©es stockÃ©es localement sur l'appareil)
- L'utilisateur contrÃ´le ses donnÃ©es via l'application
- Export possible avant suppression de l'app

**Backups :**
- Backups PostgreSQL : [DÃ©finir rÃ©tention] - ex: quotidiens gardÃ©s 30j, hebdomadaires 3 mois
- Restauration possible sur pÃ©riode dÃ©finie

---

## 4. EXIGENCES NON FONCTIONNELLES

### Exigences sur les donnÃ©es

| Exigence                    | Objectif, Score visÃ© | Moyens Ã  mettre en Å“uvre                                |
| --------------------------- | -------------------- | ------------------------------------------------------- |
| Exigence de DisponibilitÃ©   | â€”                    | â€”                                                       |
| Exigence d'IntÃ©gritÃ©        | â€”                    | ContrÃ´les d'intÃ©gritÃ© sur les donnÃ©es sensibles         |
| Exigence de ConfidentialitÃ© | â€”                    | DonnÃ©es mÃ©dicales et privÃ©es protÃ©gÃ©es, accÃ¨s restreint |
| Exigence de TraÃ§abilitÃ©     | â€”                    | Monitoring via Sentry, logs applicatifs                 |

| Information                            | Valeur       |
| -------------------------------------- | ------------ |
| Liens vers Ã©tude AIPD                  | â€”            |
| Lins vers analyse de Risque (EBIOS RM) | â€”            |
| AQSSI                                  | Ã€ renseigner |
| Responsable de traitement              | Ã€ renseigner |
| HomologuÃ© RGS                          | Ã€ renseigner |
| Date d'homologation                    | Ã€ renseigner |
| DurÃ©e d'homologation                   | Ã€ renseigner |
| Lien vers le dossier d'homologation    | Ã€ renseigner |

### PÃ©riode de service, Garantie de service, Performance

#### Site Jardin mental site Ã©ditorial

**PÃ©riode de service**

| PÃ©riode  | Date dÃ©but | Date fin | NBC | NBS |
| -------- | ---------- | -------- | --- | --- |
| Standard | Lundi      | dimanche | â€”   | â€”   |
| Critique | â€”          | â€”        | â€”   | â€”   |
| Charge   | â€”          | â€”        | â€”   | â€”   |

Description de la charge : â€”

**Garantie de service**

| Application mÃ©tier                       | Application | Standard |
| ---------------------------------------- | ----------- | -------- |
| Plage de Services InfogÃ©rance            | â€”           | â€”        |
| Perte de DonnÃ©es maximale Admissible     | 48h         | â€”        |
| DurÃ©e Maximale d'Interruption Admissible | 48h         | â€”        |

| Impact                                         | Description                                                                                                                       |
| ---------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| Impact MÃ©tier en cas de perte de donnÃ©es       | **Faible :** les stores applicatifs (google et apple) publient les mÃªmes info que le site Ã©ditorial                               |
| Impact MÃ©tier en cas de dÃ©faillance du service | **Faible :** Perte de visibilitÃ© sur l'accÃ¨s Ã  l'application mobile et les informations gÃ©nÃ©rales proposÃ©es par le site Ã©ditorial |

**Performance**

| Temps de rÃ©ponse            | PÃ©riode Standard | PÃ©riode de charge |
| --------------------------- | ---------------- | ----------------- |
| Affichage Page d'accueil    | â€”                | â€”                 |
| Affichage page simple       | â€”                | â€”                 |
| Affichage page complexe     | â€”                | â€”                 |
| Traitement requÃªte simple   | â€”                | â€”                 |
| Traitement requÃªte complexe | â€”                | â€”                 |

**ExploitabilitÃ©**

| Batch applicatif | Plage d'exÃ©cution | FrÃ©quence | Impact mÃ©tier | Impact charge |
| ---------------- | ----------------- | --------- | ------------- | ------------- |
| N/A              | â€”                 | â€”         | N/A           | N/A           |

#### Site Jardin mental Applicatif

**PÃ©riode de service**

| PÃ©riode  | Date dÃ©but | Date fin | NBC | NBS |
| -------- | ---------- | -------- | --- | --- |
| Standard | â€”          | â€”        | â€”   | â€”   |
| Critique | â€”          | â€”        | â€”   | â€”   |
| Charge   | â€”          | â€”        | â€”   | â€”   |

Description de la charge : â€”

**Garantie de service**

| Application mÃ©tier                       | Application | Standard |
| ---------------------------------------- | ----------- | -------- |
| Plage de Services InfogÃ©rance            | â€”           | â€”        |
| Perte de DonnÃ©es maximale Admissible     | â€”           | â€”        |
| DurÃ©e Maximale d'Interruption Admissible | â€”           | â€”        |

| Impact                                         | Description |
| ---------------------------------------------- | ----------- |
| Impact MÃ©tier en cas de perte de donnÃ©es       | â€”           |
| Impact MÃ©tier en cas de dÃ©faillance du service | â€”           |

**Performance**

| Temps de rÃ©ponse            | PÃ©riode Standard | PÃ©riode de charge |
| --------------------------- | ---------------- | ----------------- |
| Affichage Page d'accueil    | â€”                | â€”                 |
| Affichage page simple       | â€”                | â€”                 |
| Affichage page complexe     | â€”                | â€”                 |
| Traitement requÃªte simple   | â€”                | â€”                 |
| Traitement requÃªte complexe | â€”                | â€”                 |

**ExploitabilitÃ©**

| Batch applicatif | Plage d'exÃ©cution | FrÃ©quence | Impact mÃ©tier | Impact charge |
| ---------------- | ----------------- | --------- | ------------- | ------------- |
| â€”                | â€”                 | â€”         | â€”             | â€”             |

#### Site Jardin mental Statistiques

**PÃ©riode de service**

| PÃ©riode  | Date dÃ©but | Date fin | NBC | NBS |
| -------- | ---------- | -------- | --- | --- |
| Standard | Lundi      | Vendredi | 5   | â€”   |
| Critique | â€”          | â€”        | â€”   | â€”   |
| Charge   | â€”          | â€”        | â€”   | â€”   |

Description de la charge : â€”

**Garantie de service**

| Application mÃ©tier                       | Application | Standard |
| ---------------------------------------- | ----------- | -------- |
| Plage de Services InfogÃ©rance            | â€”           | â€”        |
| Perte de DonnÃ©es maximale Admissible     | 48h         | â€”        |
| DurÃ©e Maximale d'Interruption Admissible | 48h         | â€”        |

| Impact                                         | Description                                                                  |
| ---------------------------------------------- | ---------------------------------------------------------------------------- |
| Impact MÃ©tier en cas de perte de donnÃ©es       | **Faible :** Les statistiques d'usages se calculent sur des pÃ©riodes longues |
| Impact MÃ©tier en cas de dÃ©faillance du service | **Faible :** Les statistiques d'usages se calculent sur des pÃ©riodes longues |

**Performance**

| Temps de rÃ©ponse            | PÃ©riode Standard | PÃ©riode de charge |
| --------------------------- | ---------------- | ----------------- |
| Affichage Page d'accueil    | â€”                | â€”                 |
| Affichage page simple       | â€”                | â€”                 |
| Affichage page complexe     | â€”                | â€”                 |
| Traitement requÃªte simple   | â€”                | â€”                 |
| Traitement requÃªte complexe | â€”                | â€”                 |

**ExploitabilitÃ©**

| Batch applicatif | Plage d'exÃ©cution | FrÃ©quence | Impact mÃ©tier | Impact charge |
| ---------------- | ----------------- | --------- | ------------- | ------------- |
| â€”                | â€”                 | â€”         | â€”             | â€”             |

---

## 5. ARCHITECTURE ACTEURS ET PROCESSUS

```
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   Citoyens  â”‚              â”‚   Patients  â”‚
                  â”‚     ğŸ‘¥      â”‚              â”‚     ğŸ‘¥      â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                            â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚          Jardin Mental                      â”‚
                 â”‚                                             â”‚
                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
                 â”‚  â”‚              â”‚    â”‚              â”‚      â”‚
                 â”‚  â”‚ Site public  â”‚    â”‚ Application  â”‚      â”‚
                 â”‚  â”‚              â”‚    â”‚   mobile     â”‚      â”‚
                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                 â”‚                                             â”‚
                 â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
                 â”‚                      â”‚              â”‚      â”‚
                 â”‚                      â”‚ Statistiques â”‚â—„â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€ ğŸ‘¥ Equipe produit
                 â”‚                      â”‚              â”‚      â”‚
                 â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                 â”‚                                             â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Version Mermaid :**

```mermaid
graph TB
    subgraph Utilisateurs
        Citoyens[ğŸ‘¥ Citoyens]
        Patients[ğŸ‘¥ Patients]
        Equipe[ğŸ‘¥ Equipe produit]
    end
    subgraph JardinMental["Jardin Mental"]
        SitePublic[Site public]
        AppMobile[Application mobile]
        Stats[Statistiques]

    end
    Citoyens --> SitePublic
    Patients --> AppMobile
    Equipe --> Stats
    style JardinMental fill:#e1f5e1,color:#000000
    style Utilisateurs fill:#f0f0f0,color:#000000
```

---

## 6. ARCHITECTURE FONCTIONNELLE

```
                     ğŸ‘¥                                  ğŸ‘¥
                  Patients                            Citoyens
                     â”‚                                    â”‚
                     â–¼                                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Application Mobile       â”‚     â”‚  Jardin Mental - Site      â”‚
        â”‚                            â”‚     â”‚      Editorial             â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ Un questionnaire entiÃ¨re-  â”‚     â”‚                            â”‚
        â”‚ ment paramÃ©trable permet-  â”‚     â”‚  Informations Ã©ditoriales  â”‚
        â”‚ tant aux usagers de suivre â”‚     â”‚                            â”‚
        â”‚ l'ensemble des critÃ¨res de â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ leurs choix ainsi que      â”‚                  â”‚
        â”‚ leurs traitements          â”‚                  â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
        â”‚ Les colonnes de beck :     â”‚                  â–¼
        â”‚ un exercice de thÃ©rapie    â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ psychothÃ©rapie             â”‚     â”‚      Statistiques          â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚                            â”‚
        â”‚ Des notes : permettant Ã    â”‚     â”‚  Consultation statistique  â”‚
        â”‚ l'usagers de renseigner    â”‚     â”‚  d'utilisation de          â”‚
        â”‚ des Ã©lÃ©ments pour une      â”‚     â”‚  l'application             â”‚
        â”‚ journÃ©e donnÃ©e sous forme  â”‚     â”‚                            â”‚
        â”‚ de texte libre             â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
        â”‚ Envoi par e-mail des       â”‚                   â”‚
        â”‚ donnÃ©es renseignÃ©es vers   â”‚                   â–¼
        â”‚ un destinataire             â”‚              ğŸ‘¥
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           Equipe produit
        â”‚ Un module de retour        â”‚
        â”‚ utilisateur                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Version Mermaid :**

```mermaid
graph LR
    subgraph Utilisateurs
        Patients[ğŸ‘¥ Patients]
        Citoyens[ğŸ‘¥ Citoyens]
        Equipe[ğŸ‘¥ Equipe produit]
    end

    subgraph SiteEditorial["Site Editorial"]
        InfoEdit[Informations Ã©ditoriales]
    end

    subgraph AppMobile["Application Mobile"]
        Questionnaire[Questionnaire paramÃ©trable<br/>suivi symptÃ´mes et traitements]
        Beck[Colonnes de Beck<br/>exercice psychothÃ©rapie]
        Notes[Notes journaliÃ¨res<br/>texte libre]
        Export[Export e-mail<br/>des donnÃ©es]
        Retour[Module retour<br/>utilisateur]
    end

    subgraph Stats["Statistiques"]
        ConsultStats[Consultation statistique<br/>d'utilisation]
    end

    Patients --> Questionnaire
    Patients --> Beck
    Patients --> Notes
    Patients --> Export
    Patients --> Retour
    Citoyens --> InfoEdit
    Equipe --> ConsultStats

    style AppMobile fill:#e1f5e1
    style SiteEditorial fill:#e1f5e1
    style Stats fill:#ffe1cc
```

---

## 7. ARCHITECTURE APPLICATIVE

```
          ğŸ‘¥                            ğŸ‘¥                      ğŸ‘¥
       Citoyens                     Patients              Equipe produit
          â”‚                            â”‚                        â”‚
          â”‚                            â”‚                        â”‚
          â–¼                            â–¼                        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚             â”‚            â”‚  Application    â”‚      â”‚             â”‚
   â”‚ Application â”‚            â”‚    mobile       â”‚      â”‚    Oauth    â”‚
   â”‚             â”‚            â”‚  Android, iOS   â”‚      â”‚             â”‚
   â”‚   (JS)      â”‚            â”‚                 â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
   â”‚             â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚                      â”‚
          â”‚                            â”‚                      â”‚
          â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚      â”‚                     â”‚
          â”‚      â”‚                     â–¼
          â”‚      â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚      â”‚            â”‚  Application API â”‚
          â”‚      â”‚            â”‚                  â”‚
          â”‚      â”‚            â”‚       (JS)       â”‚
          â”‚      â”‚            â”‚                  â”‚
          â”‚      â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚      â”‚                     â”‚
          â”‚      â”‚                     â”‚
          â”‚      â”‚                     â–¼
          â”‚      â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚      â”‚            â”‚  PostgreSQL      â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”‚                  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    â”‚      â”‚  Jardin Mentale  â”‚      â”‚             â”‚
  â”‚ Notification SMTP  â”‚â—„â”€â”€â”€â”€â”€â”¤  - Applicatif    â”‚â”€â”€â”€â”€â”€â–ºâ”‚  Metabase   â”‚
  â”‚   (Tipimail)       â”‚      â”‚                  â”‚      â”‚             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚                        â”‚
                                       â”‚                        â”‚
                                       â–¼                        â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
                              â”‚   PostgreSQL     â”‚              â”‚
                              â”‚                  â”‚              â”‚
                              â”‚  Jardin Mentale  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚  - Statistiques  â”‚
                              â”‚                  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Version Mermaid :**

```mermaid
graph TB
    subgraph Utilisateurs
        Citoyens[ğŸ‘¥ Citoyens]
        Patients[ğŸ‘¥ Patients]
        EquipeProduit[ğŸ‘¥ Equipe produit]
    end

    subgraph External["Services Externes"]
        Tipimail[ğŸ“§ Tipimail<br/>Notification SMTP]
    end

    AppSitePublic[Application<br/>Site Public<br/>JS]
    AppMobile[Application mobile<br/>Android, iOS]
    Oauth[Oauth]

    API[Application API<br/>JS]
    BDD1[(PostgreSQL<br/>Jardin Mentale<br/>Applicatif)]

    Metabase[Metabase]
    BDD2[(PostgreSQL<br/>Jardin Mentale<br/>Statistiques)]

    Citoyens --> AppSitePublic
    Patients --> AppMobile
    EquipeProduit --> Oauth

    AppSitePublic --> API
    AppMobile --> API
    Oauth --> Metabase

    API --> BDD1
    API --> Tipimail

    Metabase --> BDD2
    BDD1 -.sync.-> BDD2

    style AppSitePublic fill:#e1f5e1
    style AppMobile fill:#e1f5e1
    style API fill:#e1f5e1
    style BDD1 fill:#cce5ff
    style BDD2 fill:#cce5ff
    style Metabase fill:#ffe1cc
    style External fill:#fff4e1
```

---

## 8. ARCHITECTURE TECHNIQUE

```
                      ğŸ“±
                 Application mobile
                  Android, iOS          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  ğŸ“Š Sentry
                       â”‚
      ğŸ‘¥          ğŸ‘¥   â”‚       ğŸ‘¥
   Citoyens   Patients â”‚   Equipe produit              â”€â”€â–º  ğŸ“ˆ Matomo
       â”‚          â”‚    â”‚       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                                     â”€â”€â–º  ğŸ“§ Tipimail
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Internet     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â˜¸                                                            â”‚
    â”‚  Kubernetes                                                   â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚  Plateforme                                            â”‚  â”‚
    â”‚  â”‚                                                         â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â”‚
    â”‚  â”‚   â”‚ GTW  â”‚â”€â”€â”€â”€â”€â–ºâ”‚ LB â”‚â”€â”€â”€â”€â”€â–ºâ”‚ Ingress Nginxâ”‚          â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
    â”‚  â”‚                                     â”‚                  â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                        â”‚                     â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚   â”‚                                    â–¼                  â”‚  â”‚
    â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
    â”‚   â”‚  â”‚          â”‚   â”‚          â”‚   â”‚          â”‚         â”‚  â”‚
    â”‚   â”‚  â”‚   APP    â”‚   â”‚   API    â”‚   â”‚  Oauth   â”‚         â”‚  â”‚
    â”‚   â”‚  â”‚   (JS)   â”‚   â”‚   (JS)   â”‚   â”‚          â”‚         â”‚  â”‚
    â”‚   â”‚  â”‚          â”‚   â”‚          â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
    â”‚   â”‚  â”‚          â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚               â”‚  â”‚
    â”‚   â”‚  â”‚Jardin    â”‚        â”‚              â”‚               â”‚  â”‚
    â”‚   â”‚  â”‚mentale   â”‚        â”‚              â–¼               â”‚  â”‚
    â”‚   â”‚  â”‚site      â”‚        â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
    â”‚   â”‚  â”‚public    â”‚        â”‚       â”‚              â”‚       â”‚  â”‚
    â”‚   â”‚  â”‚          â”‚        â”‚       â”‚   Metabase   â”‚       â”‚  â”‚
    â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚       â”‚              â”‚       â”‚  â”‚
    â”‚   â”‚                      â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
    â”‚   â”‚                      â–¼              â”‚               â”‚  â”‚
    â”‚   â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚               â”‚  â”‚
    â”‚   â”‚              â”‚            â”‚         â”‚               â”‚  â”‚
    â”‚   â”‚              â”‚  BDD       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
    â”‚   â”‚              â”‚ PostgreSQL â”‚                         â”‚  â”‚
    â”‚   â”‚              â”‚            â”‚                         â”‚  â”‚
    â”‚   â”‚              â”‚Jardin      â”‚                         â”‚  â”‚
    â”‚   â”‚              â”‚mentale     â”‚                         â”‚  â”‚
    â”‚   â”‚              â”‚Statistiquesâ”‚                         â”‚  â”‚
    â”‚   â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚  â”‚
    â”‚   â”‚                                                     â”‚  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**LÃ©gende des flux :**

1. APP (Site public)
2. API accÃ¨s
3. API â†” BDD
4. Oauth Proxy accÃ¨s
5. Oauth â†” Metabase
6. Metabase â†” BDD
7. API â†’ Tipimail (SMTP)
8. API â†’ Matomo

**Version Mermaid :**

```mermaid
graph TB
    subgraph Utilisateurs
        Citoyens[ğŸ‘¥ Citoyens]
        Patients[ğŸ‘¥ Patients]
        EquipeProduit[ğŸ‘¥ Equipe produit]
        AppMobile[ğŸ“± Application mobile<br/>Android, iOS]
    end

    subgraph ServicesExternes["Services Externes"]
        Sentry[ğŸ“Š Sentry]
        Matomo[ğŸ“ˆ Matomo]
        Tipimail[ğŸ“§ Tipimail]
    end

    Internet[Internet]

    subgraph Kubernetes["â˜¸ Kubernetes"]
        subgraph Plateforme
            GTW[GTW]
            LB[Load Balancer]
            IngressNginx[Ingress Nginx]
        end

        subgraph Applications
            APP["APP (JS)<br/>Jardin mentale<br/>site public"]
            API["API (JS)"]
            Oauth[Oauth]
            Metabase[Metabase]
        end

        subgraph BaseDeDonnees["Bases de donnÃ©es"]
            BDDApp[(PostgreSQL<br/>BDD Applicatif)]
            BDDStats[(PostgreSQL<br/>Jardin mentale<br/>Statistiques)]
        end
    end

    Citoyens --> Internet
    Patients --> AppMobile
    EquipeProduit --> Internet
    AppMobile --> Internet

    Internet --> GTW
    GTW --> LB
    LB --> IngressNginx

    IngressNginx --> APP
    IngressNginx --> API
    IngressNginx --> Oauth

    API --> BDDApp
    API --> Tipimail
    API --> Sentry
    API --> Matomo

    Oauth --> Metabase
    Metabase --> BDDStats

    style Kubernetes fill:#e3f2fd
    style Plateforme fill:#bbdefb
    style Applications fill:#e1f5e1
    style BaseDeDonnees fill:#cce5ff
    style ServicesExternes fill:#fff4e1
```

---

## 9. ARCHITECTURE DE DONNEES

### ModÃ¨le de donnÃ©es principal

La base de donnÃ©es PostgreSQL utilise Prisma ORM avec les modÃ¨les principaux suivants :

#### AnonymisedUser

- Utilisateur anonymisÃ©
- IdentifiÃ© par un UUID
- Token de notification unique

#### Reminder

- Rappel associÃ© Ã  un utilisateur
- Types : Main, Goal, Inactivity
- Gestion fine des jours et heures

#### ReminderUtcDaysOfWeek

- DÃ©tail des jours de la semaine pour chaque rappel
- BoolÃ©ens pour chaque jour

**Relations :**

- Un utilisateur possÃ¨de plusieurs rappels
- Chaque rappel peut avoir une configuration de jours spÃ©cifique

**Index :**

- Index sur les tokens (Hash)
- Index sur les types (Hash)
- Index sur les heures (BTree pour optimiser les requÃªtes de rappels)
- Index sur chaque jour de la semaine (Hash)

### Stockage cÃ´tÃ© client (AsyncStorage)

**Important :** Les donnÃ©es de santÃ© mentale de l'utilisateur sont stockÃ©es exclusivement sur le terminal mobile en local (AsyncStorage), jamais sur le serveur. Cela garantit une confidentialitÃ© maximale et l'autonomie de l'utilisateur sur ses donnÃ©es.

#### EntitÃ©s stockÃ©es localement

**DiaryData**
- DonnÃ©es de suivi quotidien (symptÃ´mes, traitements, notes)
- Structure : date, indicateurs, valeurs, notes libres
- Export possible par email

**Indicator**
- Indicateurs personnalisÃ©s crÃ©Ã©s par l'utilisateur
- Types : boolean, smiley, slider, custom
- CatÃ©gories : symptÃ´mes, effets indÃ©sirables, habitudes de vie
- Ordre d'affichage personnalisable

**Goal**
- Objectifs fixÃ©s par l'utilisateur
- Suivi de rÃ©alisation quotidienne
- Statistiques de progression

**Beck (Colonnes de Beck)**
- Exercice de psychothÃ©rapie cognitive
- Listes personnalisÃ©es : lieux, personnes, Ã©motions, sensations
- Historique des exercices

**Drug (Traitements)**
- MÃ©dicaments et posologie
- Historique de prise
- Effets observÃ©s

**Notes**
- Notes journaliÃ¨res en texte libre
- AssociÃ©es Ã  une date

**Configuration utilisateur**
- PrÃ©fÃ©rences d'affichage
- ParamÃ¨tres de rappels locaux
- Historique de complÃ©tion

---

## 9.1. ARCHITECTURE APPLICATION MOBILE

### Vue d'ensemble

L'application mobile Jardin Mental est une application React Native cross-platform (iOS et Android) dÃ©veloppÃ©e avec Expo. Elle fonctionne de maniÃ¨re autonome avec stockage local des donnÃ©es de santÃ©.

**CaractÃ©ristiques principales :**
- **Version actuelle** : 1.40.3 (build 199)
- **Plateformes** : iOS (bundleIdentifier: org.reactjs.native.example.monsuivipsy), Android (package: com.monsuivipsy)
- **Taille du projet** : ~349 fichiers source (TS/TSX/JS)
- **30 scÃ¨nes principales** organisÃ©es par fonctionnalitÃ©

### Stack technique

**Framework et Runtime**
- **React Native** : 0.79.7
- **React** : 19.0.0
- **Expo SDK** : 53.0.0
- **TypeScript** : 5.8.3
- **Node.js** : Requis pour le dÃ©veloppement

**UI et Styling**
- **NativeWind** : 2.0.11 (TailwindCSS pour React Native)
- **React Native Paper** : 4.12.5 (Material Design)
- **React Native SVG** : 15.14.0
- **Lottie** : 7.2.5 (animations)
- **React Native Reanimated** : 3.17.4 (animations performantes)

**Navigation**
- **React Navigation** : 6.1.18
  - Stack Navigator (navigation principale)
  - Material Top Tabs (onglets)

**State Management**
- **React Context API** (state global)
- **AsyncStorage** : 2.1.2 (stockage local persistant)
- **React Hooks** (state local)

**Data Visualization**
- **React Native Gifted Charts** : 1.4.64 (graphiques)
- **React Native Pie Chart** : 4.0.1 (graphiques circulaires)

**FonctionnalitÃ©s natives**
- **Expo Notifications** : 0.31.4 (notifications push)
- **Expo Contacts** : 14.2.5 (accÃ¨s aux contacts)
- **Expo File System** : 18.1.11 (gestion fichiers)
- **Expo Device** : 7.1.4 (info appareil)
- **React Native Device Info** : 8.3.1
- **Expo Updates** : 0.28.17 (OTA updates)

**Utilitaires**
- **date-fns** : 2.16.1 (manipulation de dates)
- **dayjs** : 1.11.3 (dates)
- **crypto-js** : 4.2.0 (chiffrement)
- **react-native-uuid** : 2.0.3 (gÃ©nÃ©ration UUID)
- **lodash** : 4.17.21 (utilitaires JS)
- **zod** : 3.25.63 (validation de schÃ©mas)

**Monitoring et Analytics**
- **Sentry** : 6.14.0 (crash reporting)
- **Matomo** : via service personnalisÃ© (analytics anonymisÃ©es)

**Tests**
- **Jest** : 29.4.0
- **React Testing Library** : 13.2.0
- **Testing Library Jest Native** : 5.4.3

### Architecture des scÃ¨nes

**30 scÃ¨nes principales organisÃ©es par domaine :**

1. **Onboarding** (`onboarding-v2/`) : Parcours d'accueil et personnalisation
2. **Survey** (`survey-v2/`, `survey/`) : Questionnaires quotidiens
3. **Status** (`status/`) : Tableau de bord et historique
4. **Suivi** (`suivi/`) : Analyses, corrÃ©lations, dÃ©clencheurs
5. **Indicateurs** (`indicateurs/`) : Gestion des indicateurs personnalisÃ©s
6. **Goals** (`goals/`) : Objectifs et suivi
7. **Beck** (`beck/`, `exercise/`) : Colonnes de Beck et exercices
8. **Crisis Plan** (`crisis-plan/`) : Plan de crise personnalisÃ©
9. **Tools** (`tools/`) : Outils et ressources
10. **Resources** (`resources/`) : Contenu Ã©ducatif
11. **Export** (`export/`) : Export des donnÃ©es par email
12. **Settings** (`settings/`) : ParamÃ¨tres de l'application
13. **Reminder** (`reminder/`) : Gestion des rappels
14. **News** (`news/`) : ActualitÃ©s et nouveautÃ©s
15. **Legal** (`legal/`) : CGU, confidentialitÃ©, mentions lÃ©gales
16. **FAQ** (`faq/`) : Questions frÃ©quentes
17. **Support** (`support/`) : Support utilisateur
18. **Drugs** (`drugs/`) : Gestion des traitements
19. **Diary** (`diary/`) : Journal et notes
20. **Data Export/Import** (`data-export-import/`) : Gestion des donnÃ©es
21. **Dev Mode** (`dev-mode/`) : Mode dÃ©veloppeur
22. Et autres...

### Flux de donnÃ©es

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Application Mobile                        â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  React Views  â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚   Context    â”‚                  â”‚
â”‚  â”‚   (Scenes)    â”‚        â”‚     API      â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚          â”‚                       â”‚                           â”‚
â”‚          â”‚                       â”‚                           â”‚
â”‚          â–¼                       â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚         AsyncStorage               â”‚                     â”‚
â”‚  â”‚  (Stockage local des donnÃ©es)      â”‚                     â”‚
â”‚  â”‚                                    â”‚                     â”‚
â”‚  â”‚  â€¢ DiaryData                       â”‚                     â”‚
â”‚  â”‚  â€¢ Indicators                      â”‚                     â”‚
â”‚  â”‚  â€¢ Goals                           â”‚                     â”‚
â”‚  â”‚  â€¢ Beck exercises                  â”‚                     â”‚
â”‚  â”‚  â€¢ Configuration                   â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                  â”‚
             â”‚ (API REST)                       â”‚ (Push)
             â–¼                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Backend API   â”‚              â”‚ Expo Push        â”‚
    â”‚  (Reminders,    â”‚              â”‚ Notifications    â”‚
    â”‚   Version check)â”‚              â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÃ©curitÃ©

**Chiffrement**
- Chiffrement des notifications push sensibles (crypto-js)
- HMAC pour validation de l'intÃ©gritÃ© des donnÃ©es

**ConfidentialitÃ©**
- Aucune donnÃ©e de santÃ© stockÃ©e sur le serveur
- Anonymisation : pas d'identifiant personnel, uniquement UUID
- DonnÃ©es stockÃ©es exclusivement en local (AsyncStorage)

**Permissions**
- Notifications (NOTIFICATIONS, POST_NOTIFICATIONS, SCHEDULE_EXACT_ALARM)
- Contacts (READ_CONTACTS) - uniquement pour le plan de crise
- Stockage (READ_EXTERNAL_STORAGE)

### Build et dÃ©ploiement

**EAS (Expo Application Services)**
- Project ID : 6567f752-92f9-4452-9841-71f6dd09842f
- Owner : fabnum
- Build profiles : production, development

**Plateformes**
- **iOS** : Build number 407, App Store
- **Android** : Version code 389, Google Play Store

**Over-The-Air Updates**
- Expo Updates pour dÃ©ploiements rapides
- Fallback cache timeout : 10s
- Policy : appVersion

**Build local possible**
- `pnpm build-local:ios`
- `pnpm build-local:android`

---

## 10. SERVEURS, COMPOSANTS APPLICATIFS

### [Site Ã©ditorial - APP]

| Attribut         | Valeur    |
| ---------------- | --------- |
| **RÃ´le**         | APP       |
| **Type**         | Conteneur |
| **CPU Requests** | 100m cpu  |
| **CPU Limits**   | 200m cpu  |
| **RAM Requests** | 256 Mo    |
| **RAM Limits**   | 384 Mo    |
| **HPA Status**   | OFF       |
| **HPA min**      | 2         |
| **HPA max**      | 2         |

**Composants :**

| CatÃ©gorie | Composant | Version | RÃ´le |
| --------- | --------- | ------- | ---- |
| APP       | NodeJS    | â€”       | â€”    |

### [Jardin Mentale - Base de donnÃ©es]

| Attribut         | Valeur          |
| ---------------- | --------------- |
| **RÃ´le**         | Base de donnÃ©es |
| **Type**         | Conteneur       |
| **CPU Requests** | 100m cpu        |
| **CPU Limits**   | 1 cpu           |
| **RAM Requests** | 1 Go            |
| **RAM Limits**   | 1 Go            |
| **HPA Status**   | OFF             |
| **HPA min**      | 3               |
| **HPA max**      | 3               |

**Composants :**

| CatÃ©gorie | Composant  | Version | RÃ´le |
| --------- | ---------- | ------- | ---- |
| CNPG      | PostgreSQL | 15      | â€”    |

### [Jardin mentale - APP]

| Attribut         | Valeur    |
| ---------------- | --------- |
| **RÃ´le**         | APP       |
| **Type**         | Conteneur |
| **CPU Requests** | 100m cpu  |
| **CPU Limits**   | 200m cpu  |
| **RAM Requests** | 512 Mo    |
| **RAM Limits**   | 768 Mo    |
| **HPA Status**   | OFF       |
| **HPA min**      | 2         |
| **HPA max**      | 2         |

**Composants :**

| CatÃ©gorie | Composant  | Version | RÃ´le                              |
| --------- | ---------- | ------- | --------------------------------- |
| Runtime   | NodeJS     | >= 14   | Environnement d'exÃ©cution         |
| Framework | Express.js | 4.18.2  | Framework web                     |
| Language  | TypeScript | 5.8.3   | Langage de programmation          |
| ORM       | Prisma     | 4.4.0   | ORM pour PostgreSQL               |
| Monitoring| Sentry     | 7.120.3 | Monitoring et gestion des erreurs |

### [Jardin mentale - statistiques - Metabase]

| Attribut       | Valeur      |
| -------------- | ----------- |
| **RÃ´le**       | Statistique |
| **Type**       | Conteneur   |
| **HPA Status** | OFF         |
| **HPA min**    | 1           |
| **HPA max**    | 1           |

**Composants :**

| CatÃ©gorie   | Composant | Version | RÃ´le |
| ----------- | --------- | ------- | ---- |
| Statistique | Metabase  | â€”       | â€”    |

### [Jardin mentale - Oauth]

| Attribut       | Valeur           |
| -------------- | ---------------- |
| **RÃ´le**       | Authentification |
| **Type**       | conteneur        |
| **HPA Status** | OFF              |
| **HPA min**    | 1                |
| **HPA max**    | 1                |

**Composants :**

| CatÃ©gorie | Composant   | Version | RÃ´le |
| --------- | ----------- | ------- | ---- |
| APP       | oauth proxy | â€”       | â€”    |

### [Jardin mentale - statistiques - BDD]

| Attribut         | Valeur          |
| ---------------- | --------------- |
| **RÃ´le**         | Base de donnÃ©es |
| **Type**         | Conteneur       |
| **CPU Requests** | 256m cpu        |
| **CPU Limits**   | 512m cpu        |
| **RAM Requests** | 1 Go            |
| **RAM Limits**   | 1 Go            |
| **HPA Status**   | OFF             |
| **HPA min**      | 3               |
| **HPA max**      | 3               |

**Composants :**

| CatÃ©gorie | Composant  | Version | RÃ´le |
| --------- | ---------- | ------- | ---- |
| CNPG      | PostgreSQL | 15      | â€”    |

### [Jardin mentale - statistiques - BSS Sync]

| Attribut         | Valeur                          |
| ---------------- | ------------------------------- |
| **RÃ´le**         | Base de donnÃ©es Synchronisation |
| **Type**         | Conteneur                       |
| **CPU Requests** | 100m cpu                        |
| **CPU Limits**   | 4 cpu                           |
| **RAM Requests** | 1 Go                            |
| **RAM Limits**   | 1Go                             |
| **HPA Status**   | OFF                             |
| **HPA min**      | 1                               |
| **HPA max**      | 1                               |

**Composants :**

| CatÃ©gorie | Composant  | Version | RÃ´le |
| --------- | ---------- | ------- | ---- |
| CNPG      | PostgreSQL | 15      | â€”    |

---

## 11. MATRICES DES FLUX APPLICATIVE ET SYSTEME

### Matrice de flux Applicatif - Site Editorial

| NÂ° Flux | Source | Destination        | Port | Protocole | Commentaires |
| ------- | ------ | ------------------ | ---- | --------- | ------------ |
| 1       | 1P     | Site Jardin mental | 443  | HTTPS     | â€”            |

### Matrice de flux Applicatif - Jardin Mental

| NÂ° Flux | Source | Destination | Port | Protocole | Commentaires |
| ------- | ------ | ----------- | ---- | --------- | ------------ |
| 11      | 1P     | API         | 443  | HTTPS     | â€”            |
| 12      | API    | BDD         | 5432 | PG        | â€”            |
| 16      | API    | TIPIMAIL    | 587  | SMTP      | â€”            |
| 17      | API    | SENTRY      | 443  | HTTPS     | â€”            |

### Matrice de flux Applicatif - Statistiques

| NÂ° Flux | Source      | Destination | Port | Protocole | Commentaires |
| ------- | ----------- | ----------- | ---- | --------- | ------------ |
| 13      | 1P          | oauth proxy | 443  | HTTPS     | â€”            |
| 14      | oauth proxy | metabase    | 443  | HTTPD     | â€”            |
| 15      | metabase    | BDD         | 5432 | PG        | â€”            |

### Matrice de flux plateforme

| NÂ° Flux | Source        | Destination   | Port     | Protocole    | Commentaires |
| ------- | ------------- | ------------- | -------- | ------------ | ------------ |
| 1P      | Internet      | Firewall      | 80 - 443 | HTTP - HTTPS | â€”            |
| 1P      | Firewall      | Load Balancer | 80 - 443 | HTTP - HTTPS | â€”            |
| 1P      | Load Balancer | Ingress NGINX | 80 - 443 | HTTP - HTTPS | â€”            |

---

## URLS ET CERTIFICATS

### URLs Site Jardin Mental

| Attribut                     | Valeur                                       |
| ---------------------------- | -------------------------------------------- |
| **URL**                      | https://jardinmental.fabrique.social.gouv.fr |
| **Equipement portant l'URL** | â€”                                            |
| **Usage**                    | â€”                                            |
| **SSL**                      | Oui                                          |
| **Type certificat**          | â€”                                            |
| **VIP**                      | â€”                                            |
| **LB / RP**                  | Oui                                          |
| **Terminaison SSL**          | â€”                                            |

---

## INFORMATIONS TECHNIQUES COMPLÃ‰MENTAIRES

### Technologies Frontend (Mobile)

- **Framework** : React Native 0.79.7 avec Expo SDK 53
- **Langage** : TypeScript 5.8.3
- **UI Framework** : NativeWind (TailwindCSS), React Native Paper
- **Gestionnaire de paquets** : pnpm >= 8 (actuellement 10.24.0)
- **Plateforme** : iOS (build 407) et Android (versionCode 389)
- **Navigation** : React Navigation 6 (Stack + Material Top Tabs)
- **State** : React Context API + AsyncStorage 2.1.2
- **Charts** : React Native Gifted Charts 1.4.64
- **Animations** : React Native Reanimated 3.17.4, Lottie 7.2.5
- **Analytics** : Matomo (via service logEvents personnalisÃ©, anonymisÃ©)
- **Monitoring** : Sentry 6.14.0 (crash reporting)
- **Tests** : Jest 29.4.0 + React Testing Library 13.2.0
- **Publication** : EAS Build (Expo Application Services), publication App Store et Play Store
- **OTA Updates** : Expo Updates 0.28.17

### Technologies Backend (API)

- **Runtime** : Node.js >= 14
- **Framework** : Express 4.18.2
- **Langage** : TypeScript 5.8.3 (migration complÃ¨te depuis JavaScript)
- **ORM** : Prisma 4.4.0 avec Prisma Client
- **Base de donnÃ©es** : PostgreSQL 15
- **Gestionnaire de paquets** : pnpm >= 8 (actuellement 10.24.0)
- **Monitoring** : Sentry Node 7.120.3 avec profiling
- **Security** : Helmet 4.0.0, CORS, express-rate-limit 7.5.0
- **Logging** : Morgan 1.10.0
- **Scheduling** : node-cron 3.0.2 (pour rappels et tÃ¢ches rÃ©currentes)
- **Notifications Push** : expo-server-sdk 3.13.0
- **Email** : Tipimail (SMTP)
- **Cryptographie** : crypto-js 4.2.0 (HMAC)
- **Tests** : Jest 29.7.0 + Supertest 7.1.1 + ts-jest 29.3.4
- **Build** : TypeScript compiler, nodemon pour dÃ©veloppement

### FonctionnalitÃ©s Backend

**Endpoints REST (3 contrÃ´leurs principaux)**
- **/event** : Tracking d'Ã©vÃ©nements et analytics
- **/reminder** : Gestion des rappels (CRUD)
- **/mail** : Export de donnÃ©es par email via Tipimail
- **/version** : VÃ©rification de version de l'app mobile
- **/config** : Configuration API et versions
- **/healthz** : Health check pour Kubernetes
- **/debug** : Endpoints de debug (activables via feature flag)

**Cron jobs**
- Envoi automatique des rappels selon configuration utilisateur
- Support des rappels Main, Goal, Inactivity
- Gestion des fuseaux horaires (UTC)
- Planification fine par jour de semaine et heure

**Middlewares**
- **Gestion des erreurs** : Middleware centralisÃ© + Sentry error handler
- **Rate limiting** : express-rate-limit pour protection contre abus
- **VÃ©rification de version** : Force la mise Ã  jour si version mobile < minimum requis (build 116)
- **SÃ©curitÃ©** : Helmet (headers HTTP sÃ©curisÃ©s), CORS configurÃ©
- **Logging** : Morgan en dÃ©veloppement
- **Body parsing** : JSON (limite 50mb pour export de donnÃ©es)

### SÃ©curitÃ© et ConformitÃ©

- **Anonymisation** : Aucun identifiant personnel stockÃ©, UUID uniquement
- **Tokens de notification** : StockÃ©s de faÃ§on unique et indexÃ©s
- **Validation** : Typage strict, validation des entrÃ©es
- **Monitoring** : Sentry pour le suivi des erreurs
- **ConformitÃ©** : RGPD, RGS, RGI, RGAA

### DÃ©ploiement

**Mobile**
- **Build System** : EAS (Expo Application Services)
- **Build profiles** : production, development
- **Builds locaux** : Possibles via `eas build --local`
- **Publication** :
  - iOS : App Store via `eas submit --platform ios`
  - Android : Google Play Store via `eas submit --platform android`
- **OTA Updates** : Via Expo Updates pour dÃ©ploiements rapides sans stores
- **Owner** : fabnum (organisation Expo)

**API**
- **Containerisation** : Docker + docker-compose
- **Orchestration** : Kubernetes (Fabrique NumÃ©rique)
- **Base de donnÃ©es** : PostgreSQL via CNPG (CloudNativePG)
- **Ingress** : Nginx Ingress Controller
- **Load Balancing** : Load Balancer + Gateway
- **SSL/TLS** : Certificats gÃ©rÃ©s automatiquement
- **Variables d'environnement** :
  - `DATABASE_URL` : Connexion PostgreSQL
  - `SENTRY_KEY` : ClÃ© Sentry
  - `TIPIMAIL_API_KEY`, `TIPIMAIL_API_USER` : Credentials SMTP
  - `PUSH_NOTIFICATION_*` : Credentials notifications iOS/Android
  - `HMAC_SECRET` : Secret pour validation HMAC
  - `CRONJOBS_ENABLED` : Activation des cron jobs
  - `DEBUG_ENDPOINTS_ENABLED` : Activation endpoints de debug

**CI/CD**
- **Tests automatisÃ©s** : Jest sur API et mobile
- **VÃ©rification de type** : TypeScript strict
- **Linting** : ESLint
- **Git Hooks** : Husky + Talisman (dÃ©tection de secrets)
- **Package Manager** : pnpm avec workspaces

**Environnements**
- **DÃ©veloppement** : Local avec docker-compose (PostgreSQL + MailDev)
- **Test** : Environnement de test isolÃ©
- **Production** : Kubernetes sur infrastructure Fabrique NumÃ©rique

---

## SERVICES EXTERNES

### Tipimail (SMTP)
- **Utilisation** : Envoi d'emails d'export de donnÃ©es
- **Mode d'Ã©change** : SMTP (port 587)
- **Authentification** : API Key + API User
- **Flux** : API â†’ Tipimail (HTTPS)

### Sentry
- **Utilisation** : Monitoring des erreurs et performance
- **Composants** :
  - Sentry React Native (mobile) : 6.14.0
  - Sentry Node (backend) : 7.120.3 avec profiling
- **Flux** : API/Mobile â†’ Sentry (HTTPS sur port 443)
- **DonnÃ©es collectÃ©es** : Erreurs, stack traces, contexte, breadcrumbs

### Matomo
- **Utilisation** : Analytics anonymisÃ©es d'usage
- **ImplÃ©mentation** : Service personnalisÃ© `logEvents.js`
- **Flux** : API â†’ Matomo (HTTPS sur port 443)
- **DonnÃ©es collectÃ©es** : Ã‰vÃ©nements utilisateur anonymisÃ©s, parcours

### Expo Services
- **Expo Push Notifications** : Service de notifications push unifiÃ© iOS/Android
  - expo-server-sdk cÃ´tÃ© backend
  - expo-notifications cÃ´tÃ© mobile
- **Expo Updates** : DÃ©ploiement OTA (Over-The-Air)
- **EAS Build** : Service de build cloud
- **EAS Submit** : Soumission automatisÃ©e aux stores

### Metabase
- **Utilisation** : Consultation de statistiques d'usage (Ã©quipe produit)
- **AccÃ¨s** : Via Oauth proxy
- **Base de donnÃ©es** : PostgreSQL Statistiques (rÃ©plica/sync)
- **Flux** : Oauth â†’ Metabase â†’ BDD Stats

### Apple Push Notification Service (APNs)
- **Utilisation** : Notifications push iOS
- **Authentification** : Certificat APN (key, key ID, team ID)
- **IntÃ©gration** : Via expo-server-sdk

### Firebase Cloud Messaging (FCM)
- **Utilisation** : Notifications push Android
- **Configuration** : google-services.json
- **Authentification** : GCM ID
- **IntÃ©gration** : Via expo-server-sdk

---

## LIENS UTILES ET DOCUMENTATION

- [Site officiel](https://jardinmental.fabrique.social.gouv.fr/)
- [Documentation mobile](app/README.md)
- [Documentation API TypeScript](api/README-TypeScript.md)
- [Intentions du projet](https://beta.gouv.fr/startups/monsuivipsy.html)

---

## SECTIONS Ã€ COMPLÃ‰TER MANUELLEMENT

Les sections suivantes nÃ©cessitent des informations non dÃ©ductibles du code source et doivent Ãªtre complÃ©tÃ©es manuellement par l'Ã©quipe :

### Section 1 - PROJET - ACTEURS
- **Planning projet** : Dates et versions prÃ©vues
- **Acteurs Projet** : Noms manquants (Product Manager, Designer, DÃ©veloppeurs)

### Section 3 - CONTRAINTES â€“ VOLUMETRIE
- **Contraintes lÃ©gales** : DÃ©tails des obligations lÃ©gales spÃ©cifiques
- **Contraintes mÃ©tiers** : Exigences mÃ©tier spÃ©cifiques
- **VolumÃ©trie donnÃ©es** : Toutes les mÃ©triques (nombre d'enregistrements, taille moyenne, etc.)
- **VolumÃ©trie fichiers** : Toutes les mÃ©triques

### Section 4 - EXIGENCES NON FONCTIONNELLES

**Champs rÃ©glementaires Ã  renseigner :**
- AQSSI (AutoritÃ© QualifiÃ©e pour la SÃ©curitÃ© des SystÃ¨mes d'Information)
- Responsable de traitement (RGPD)
- HomologuÃ© RGS (RÃ©fÃ©rentiel GÃ©nÃ©ral de SÃ©curitÃ©)
- Date d'homologation
- DurÃ©e d'homologation
- Lien vers le dossier d'homologation
- Lien vers Ã©tude AIPD (Analyse d'Impact sur la Protection des DonnÃ©es)
- Lien vers analyse de Risque (EBIOS RM)

**Garanties de service :**
- Plages de Services InfogÃ©rance
- Perte de DonnÃ©es maximale Admissible (dÃ©tails)
- DurÃ©e Maximale d'Interruption Admissible (dÃ©tails)
- Temps de rÃ©ponse attendus (tous les champs)
- PÃ©riodes de service dÃ©taillÃ©es (NBC, NBS)

---

**Document mis Ã  jour le :** 2026-02-06 (derniÃ¨re mise Ã  jour automatique)

**DerniÃ¨re mise Ã  jour manuelle :** 2026-01-30
